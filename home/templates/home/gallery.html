{% extends "base.html" %}
{% load static %}

{% block content %}
<script>
  $(document).ready(function() {
    $('#myCarousel').carousel({
      interval: false
    });
    $('#carousel-thumbs').carousel({
      interval: false
    });
    
    // handles the carousel thumbnails
    // https://stackoverflow.com/questions/25752187/bootstrap-carousel-with-thumbnails-multiple-carousel

        // when user clicks on a carousel item, update the active item
    $('#carousel-thumbs .carousel-item').on('click', function() {
      var id = $(this).index(); // Get the index of the clicked item
      $('#myCarousel').carousel(id); // Update the main carousel's active item
    });

    $('[id^=carousel-selector-]').click(function() {
      var id_selector = $(this).attr('id');
      var id = parseInt( id_selector.substr(id_selector.lastIndexOf('-') + 1) );
      $('#myCarousel').carousel(id);
    });
    // Only display 3 items in nav on mobile.
    if ($(window).width() < 575) {
      $('#carousel-thumbs .row div:nth-child(4)').each(function() {
        var rowBoundary = $(this);
        $('<div class="row mx-0">').insertAfter(rowBoundary.parent()).append(rowBoundary.nextAll().addBack());
      });
      $('#carousel-thumbs .carousel-item .row:nth-child(even)').each(function() {
        var boundary = $(this);
        $('<div class="carousel-item">').insertAfter(boundary.parent()).append(boundary.nextAll().addBack());
      });
    }
    // Hide slide arrows if too few items.
    if ($('#carousel-thumbs .carousel-item').length < 2) {
      $('#carousel-thumbs [class^=carousel-control-]').remove();
      $('.machine-carousel-container #carousel-thumbs').css('padding','0 5px');
    }
    // when the carousel slides, auto update
    $('#myCarousel').on('slide.bs.carousel', function(e) {
      var id = parseInt( $(e.relatedTarget).attr('data-slide-number') );
      $('[id^=carousel-selector-]').removeClass('selected');
      $('[id=carousel-selector-'+id+']').addClass('selected');
    });
    // when user swipes, go next or previous
    $('#myCarousel').swipe({
      fallbackToMouseEvents: true,
      swipeLeft: function(e) {
        $('#myCarousel').carousel('next');
      },
      swipeRight: function(e) {
        $('#myCarousel').carousel('prev');
      },
      allowPageScroll: 'vertical',
      preventDefaultEvents: false,
      threshold: 75
    });
    
    $('#myCarousel .carousel-item img').on('click', function(e) {
      var src = $(e.target).attr('data-remote');
      if (src) $(this).ekkoLightbox();
    });
  });
</script>

<div class="container mt-5">
   <div class="carousel-container position-relative row">  
   <div id="myCarousel" class="carousel slide" data-ride="carousel">
     <div class="carousel-inner">
       <div class="carousel-item active" data-slide-number="">
          <img src="{% static featured_image.image.url %}" class="d-block w-100" alt="{{ featured_image.description }}" data-remote="" data-type="image" data-toggle="lightbox" data-gallery="example-gallery">
       </div>
     </div>
   </div>
   <!-- Carousel Navigation -->
   <div id="carousel-thumbs" class="carousel slide" data-ride="carousel">
     <div class="carousel-inner thumbs-section">
       <!-- <div class="carousel-item active">
         <div class="row mx-0">
           <div id="carousel-selector-0" class="thumb col-4 col-sm-2 px-1 py-2 selected" data-target="#myCarousel" data-slide-to="0">
             <img src="{% static featured_image.image.url %}" class="img-fluid" alt="{{ featured_image.description }}">
           </div>
         </div>
       </div> -->
       {% for image in images %}
       <div class="carousel-item">
         <div class="row mx-0">
           <div id="carousel-selector-{{ forloop.counter0 }}" class="thumb col-4 col-sm-2 px-1 py-2" data-target="#myCarousel" data-slide-to="{{ forloop.counter0 }}">
             <img src="{% static image.image.url %}" class="img-fluid" alt="{{ image.description }}">
           </div>
           <!-- <div class="col-2 px-1 py-2"></div>
           <div class="col-2 px-1 py-2"></div> -->
         </div>
       </div>
       {% endfor %}
     </div>
     <a class="carousel-control-prev" href="#carousel-thumbs" role="button" data-slide="prev">
       <span class="carousel-control-prev-icon" aria-hidden="true"></span>
       <span class="sr-only">Previous</span>
     </a>
     <a class="carousel-control-next" href="#carousel-thumbs" role="button" data-slide="next">
       <span class="carousel-control-next-icon" aria-hidden="true"></span>
       <span class="sr-only">Next</span>
     </a>
   </div>
   
   </div>
   </div>
{% endblock %}